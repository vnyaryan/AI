{
    "command_group": "az policy state",
    "description": "Manage policy compliance states.",
    "status": "GA",
    "commands": [
        {
            "name": "az policy state list",
            "summary": "List policy compliance states.",
            "syntax": "az policy state list [--all]\n                     [--apply]\n                     [--expand]\n                     [--filter]\n                     [--from]\n                     [--management-group]\n                     [--namespace]\n                     [--order-by]\n                     [--parent]\n                     [--policy-assignment]\n                     [--policy-definition]\n                     [--policy-set-definition]\n                     [--resource]\n                     [--resource-group]\n                     [--resource-type]\n                     [--select]\n                     [--to]\n                     [--top]",
            "required_parameters": [],
            "optional_parameters": [
                "--all",
                "--apply",
                "--expand",
                "--filter",
                "--from",
                "--management-group -m",
                "--namespace",
                "--order-by",
                "--parent",
                "--policy-assignment -a",
                "--policy-definition -d",
                "--policy-set-definition -s",
                "--resource",
                "--resource-group -g",
                "--resource-type",
                "--select",
                "--to",
                "--top"
            ],
            "examples": [
                "az policy state list",
                "az policy state list --all",
                "az policy state list -m \"myMg\"",
                "az policy state list -g \"myRg\"",
                "az policy state list --resource \"/subscriptions/fff10b27-fff3-fff5-fff8-fffbe01e86a5/resourceGroups/myResourceGroup /providers/Microsoft.EventHub/namespaces/myns1/eventhubs/eh1/consumergroups/cg1\"",
                "az policy state list --resource \"myKeyVault\" --namespace \"Microsoft.KeyVault\" --resource-type \"vaults\" -g \"myresourcegroup\"",
                "az policy state list --resource \"myRule1\" --namespace \"Microsoft.Network\" --resource-type \"securityRules\" --parent \"networkSecurityGroups/mysecuritygroup1\" -g \"myresourcegroup\"",
                "az policy state list -s \"fff58873-fff8-fff5-fffc-fffbe7c9d697\"",
                "az policy state list -d \"fff69973-fff8-fff5-fffc-fffbe7c9d698\"",
                "az policy state list -a \"ddd8ef92e3714a5ea3d208c1\"",
                "az policy state list -g \"myRg\" -a \"ddd8ef92e3714a5ea3d208c1\"",
                "az policy state list --top 5 --order-by \"timestamp desc, policyAssignmentName asc\" --select \"timestamp, resourceId, policyAssignmentId, policySetDefinitionId, policyDefinitionId\"",
                "az policy state list --from \"2018-03-08T00:00:00Z\" --to \"2018-03-15T00:00:00Z\"",
                "az policy state list --filter \"(policyDefinitionAction eq 'deny' or policyDefinitionAction eq 'audit') and resourceLocation ne 'eastus'\"",
                "az policy state list --apply \"aggregate($count as numberOfRecords)\"",
                "az policy state list --apply \"groupby((policyAssignmentId, policySetDefinitionId, policyDefinitionReferenceId, policyDefinitionId), aggregate($count as numStates))\"",
                "az policy state list --apply \"groupby((policyAssignmentName, resourceId))\"",
                "az policy state list --apply \"groupby((policyAssignmentId, policySetDefinitionId, policyDefinitionReferenceId, policyDefinitionId, resourceId))/groupby((policyAssignmentId, policySetDefinitionId, policyDefinitionReferenceId, policyDefinitionId), aggregate($count as numNonCompliantResources))\"",
                "az policy state list --resource \"myKeyVault\" --namespace \"Microsoft.KeyVault\" --resource-type \"vaults\" -g \"myresourcegroup\" --expand PolicyEvaluationDetails",
                "az policy state list --resource \"/subscriptions/fff10b27-fff3-fff5-fff8-fffbe01e86a5/resourceGroups/myResourceGroup/providers/Microsoft.KeyVault/vaults/myKeyVault\" --filter \"policyAssignmentId eq '/subscriptions/fff10b27-fff3-fff5-fff8-fffbe01e86a5/providers/Microsoft.Authorization/policyAssignments/myPa'\" --expand \"Components($filter=ComplianceState eq 'NonCompliant' or ComplianceState eq 'Compliant')\"",
                "az policy state list --resource \"/subscriptions/fff10b27-fff3-fff5-fff8-fffbe01e86a5/resourceGroups/myResourceGroup/providers/Microsoft.KeyVault/vaults/myKeyVault\" --filter \"policyAssignmentId eq '/subscriptions/fff10b27-fff3-fff5-fff8-fffbe01e86a5/providers/Microsoft.Authorization/policyAssignments/myPa' and policyDefinitionReferenceId eq 'myResourceProviderModeDefinitionReferenceId'\" --expand \"Components($filter=ComplianceState eq 'NonCompliant' or ComplianceState eq 'Compliant')\"",
                "az policy state list --resource \"/subscriptions/fff10b27-fff3-fff5-fff8-fffbe01e86a5/resourceGroups/myResourceGroup/providers/Microsoft.KeyVault/vaults/myKeyVault\" --filter \"policyAssignmentId eq '/subscriptions/fff10b27-fff3-fff5-fff8-fffbe01e86a5/providers/Microsoft.Authorization/policyAssignments/myPa'\" --expand \"Components($filter=ComplianceState eq 'NonCompliant' or ComplianceState eq 'Compliant' or ComplianceState eq 'Conflict';$apply=groupby((complianceState),aggregate($count as count)))\""
            ]
        },
        {
            "name": "az policy state summarize",
            "summary": "Summarize policy compliance states.",
            "syntax": "az policy state summarize [--filter]\n                          [--from]\n                          [--management-group]\n                          [--namespace]\n                          [--parent]\n                          [--policy-assignment]\n                          [--policy-definition]\n                          [--policy-set-definition]\n                          [--resource]\n                          [--resource-group]\n                          [--resource-type]\n                          [--to]\n                          [--top]",
            "required_parameters": [],
            "optional_parameters": [
                "--filter",
                "--from",
                "--management-group -m",
                "--namespace",
                "--parent",
                "--policy-assignment -a",
                "--policy-definition -d",
                "--policy-set-definition -s",
                "--resource",
                "--resource-group -g",
                "--resource-type",
                "--to",
                "--top"
            ],
            "examples": [
                "az policy state summarize",
                "az policy state summarize -m \"myMg\"",
                "az policy state summarize -g \"myRg\"",
                "az policy state summarize --resource \"/subscriptions/fff10b27-fff3-fff5-fff8-fffbe01e86a5/resourceGroups/myResourceGroup /providers/Microsoft.EventHub/namespaces/myns1/eventhubs/eh1/consumergroups/cg1\"",
                "az policy state summarize --resource \"myKeyVault\" --namespace \"Microsoft.KeyVault\" --resource-type \"vaults\" -g \"myresourcegroup\"",
                "az policy state summarize --resource \"myRule1\" --namespace \"Microsoft.Network\" --resource-type \"securityRules\" --parent \"networkSecurityGroups/mysecuritygroup1\" -g \"myresourcegroup\"",
                "az policy state summarize -s \"fff58873-fff8-fff5-fffc-fffbe7c9d697\"",
                "az policy state summarize -d \"fff69973-fff8-fff5-fffc-fffbe7c9d698\"",
                "az policy state summarize -a \"ddd8ef92e3714a5ea3d208c1\"",
                "az policy state summarize -g \"myRg\" -a \"ddd8ef92e3714a5ea3d208c1\"",
                "az policy state summarize --top 5",
                "az policy state summarize --from \"2018-03-08T00:00:00Z\" --to \"2018-03-15T00:00:00Z\"",
                "az policy state summarize --filter \"(policyDefinitionAction eq 'deny' or policyDefinitionAction eq 'audit') and resourceLocation ne 'eastus'\""
            ]
        },
        {
            "name": "az policy state trigger-scan",
            "summary": "Trigger a policy compliance evaluation for a scope.",
            "syntax": "az policy state trigger-scan [--no-wait]\n                             [--resource-group]",
            "required_parameters": [],
            "optional_parameters": [
                "--no-wait",
                "--resource-group -g"
            ],
            "examples": [
                "az policy state trigger-scan",
                "az policy state trigger-scan -g \"myRg\"",
                "az policy state trigger-scan -g \"myRg\" --no-wait"
            ]
        }
    ]
}